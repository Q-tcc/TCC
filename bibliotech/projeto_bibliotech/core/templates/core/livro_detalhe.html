{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="detail-page-container">

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                    {{ message }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
    <div class="crubs">
        {{ livro.autor|upper }}
        {% for categoria in livro.categorias.all %}
            / {{ categoria.nome|upper }}
        {% endfor %}
    </div>

    <div class="book-detail-main">
        
        <div class="book-cover-container">
            <img src="{{ livro.capa.url }}" alt="Capa do {{ livro.titulo }}">
        </div>

        <div class="book-info-container">

            <h1>{{ livro.titulo }}</h1>

            <div class="rating-and-meta">
    <div class="rating">
        <span>{{ livro.rating }}</span>
        ★★★★★
    </div>
    <span>Data limite: {{ livro.data_limite_dias }} dias</span>
</div>

{% if reserva_do_usuario %}

    <div class="ja-reservado">
        <h3>Você já reservou este livro!</h3>
        <p><strong>Empréstimo:</strong> {{ reserva_do_usuario.data_emprestimo|date:"d/m/Y" }}</p>
        <p><strong>Devolução:</strong> {{ reserva_do_usuario.data_devolucao|date:"d/m/Y" }}</p>
    </div>

{% else %}

    {% if livro.is_available %}

        <p class="status-disponivel">Disponível</p>

        {% if user.is_authenticated %}
            {% if user.is_staff %}
                <a href="{% url 'editar_livro' livro.id %}" class="btn-action btn-edit">Editar Livro</a>
                <a href="{% url 'excluir_livro' livro.id %}" class="btn-action btn-delete">Excluir Livro</a>
            {% else %}
                <form action="{% url 'reservar_livro' livro.id %}" method="POST" class="form-action">
                    {% csrf_token %}
                    <button type="submit" class="btn-action btn-reserve">Reservar</button>
                </form>
            {% endif %}
        {% else %}
            <a href="{% url 'login' %}?next={{ request.path }}" class="btn-action btn-login-prompt">Faça login para reservar</a>
        {% endif %}

    {% else %}
        <p class="status-indisponivel">Livro Indisponível</p>
    {% endif %}

{% endif %}

</div>

    </div>

    </div> <div class="similar-books-section">
        <h2>Parecidos com:</h2>
        <div class="similar-books-list">
            {% for similar in livros_similares %}
                <a href="{% url 'livro_detalhe' similar.id %}" class="similar-book-card">
                    <img src="{{ similar.capa.url }}" alt="Capa do {{ similar.titulo }}">
                </a>
            {% empty %}
                <p>Nenhum livro similar encontrado.</p>
            {% endfor %}
        </div>
    </div>

</div>

{% endblock %}